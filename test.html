<!DOCTYPE html>
<html lang="en">
<head>
  <title>complex function explorer</title>
  <meta charset="utf-8">
  <script src="js/three.min.js"></script>
  <script src="js/dat.gui.min.js"></script>
</head>
<body>
<canvas id="Canvas" width="600px" height="600px"></canvas>

<script>
var canvas = document.getElementById("Canvas");
var context = canvas.getContext("2d");
var imageData = context.createImageData(canvas.width, canvas.height);
for ( let i=0; i<imageData.data.length; i+=4 ) {
  imageData.data[i] = 128;
  imageData.data[i+1] = 128;
  imageData.data[i+2] = 128;
  imageData.data[i+3] = 255;
}
context.putImageData(imageData, 0, 0);

function hue2rgb(p, q, t) {
  if ( t < 0 ) t += 1;
  if ( t > 1 ) t -= 1;
  if ( t < 1/6 ) return p + (q - p) * 6 * t;
  if ( t < 1/2 ) return q;
  if ( t < 2/3 ) return p + (q - p) * (2/3 - t) * 6;
  return p;
}
function hslToRgb(h, s, l) {
  var r, g, b;

  if ( s == 0 ) {
    r = g = b = l; // achromatic
  } else {
    var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
    var p = 2 * l - q;
    r = hue2rgb(p, q, h + 1/3);
    g = hue2rgb(p, q, h);
    b = hue2rgb(p, q, h - 1/3);
  }

  return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
}
function toColor(r, phi, l=0.5) {
  return hslToRgb((phi/2/Math.PI+1)%1, Math.tanh(r), l);
}

// sqrt(z)
function toRPhi(x, y) {
  return [Math.sqrt(x*x+y*y), Math.atan2(y, x)];
}
function toXY(r, phi) {
  return [r*Math.cos(phi), r*Math.sin(phi)];
}
function func(r, phi) {
  var r_ = Math.sqrt(r)**3;
  var phi_ = phi*3/2;
  return [[r_, phi_], [r_, phi_+Math.PI]];
}

const cx = 300, cy = 300, scale = 50;
const width = 50, height = 50;
var range = context.createImageData(width, height);

function look(event) {
  const x = event.layerX-8, y = event.layerY-8;
  const x0 = x-width/2, y0 = y-height/2;

  for ( let i=0; i<height; i++ )
    for ( let j=0; j<width; j++ ) {
      let [[r, phi]] = func(...toRPhi((x0+j-cx)/scale, -(y0+i-cy)/scale));
      let rgb = toColor(r, phi);

      let n = 4*(width*i+j);
      range.data[n] = rgb[0];
      range.data[n+1] = rgb[1];
      range.data[n+2] = rgb[2];
      range.data[n+3] = 255;
    }
  context.putImageData(range, x0, y0);
}
function click(event) {
  const x = event.layerX-8, y = event.layerY-8;
  let [[r, phi]] = func(...toRPhi((x-cx)/scale, -(y-cy)/scale));
  console.log(r, phi);
}
canvas.addEventListener("mousemove", look);
canvas.addEventListener("click", click);
</script>
</body>
</html>
