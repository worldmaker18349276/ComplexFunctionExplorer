<!DOCTYPE html>
<html lang="en">
<head>
  <title>complex function explorer</title>
  <meta charset="utf-8">
  <script src="js/three.min.js"></script>
  <script src="js/dat.gui.min.js"></script>
  <script src="complex.js"></script>
</head>
<body>
<canvas id="Canvas" width="600px" height="600px"></canvas>

<script>
var canvas = document.getElementById("Canvas");
var context = canvas.getContext("2d");
var imageData = context.createImageData(canvas.width, canvas.height);
for ( let i=0; i<imageData.data.length; i+=4 ) {
  imageData.data[i] = 128;
  imageData.data[i+1] = 128;
  imageData.data[i+2] = 128;
  imageData.data[i+3] = 255;
}
context.putImageData(imageData, 0, 0);

var expr = new Mul(Z, new ConstPow(new Add(Z, new Constant([-1, 0.5])), -Math.PI));

const cx = 300, cy = 300, scale = 50;
const width = 50, height = 50;
var range = context.createImageData(width, height);

function look(event) {
  const x = event.layerX-8, y = event.layerY-8;
  const x0 = x-width/2, y0 = y-height/2;

  for ( let i=0; i<height; i++ )
    for ( let j=0; j<width; j++ ) {
      let val = expr.eval([(x0+j-cx)/scale, -(y0+i-cy)/scale], {});
      let rgb = toColor(val);

      let n = 4*(width*i+j);
      range.data[n] = rgb[0];
      range.data[n+1] = rgb[1];
      range.data[n+2] = rgb[2];
      range.data[n+3] = 255;
    }
  context.putImageData(range, x0, y0);
}
function click(event) {
  const x = event.layerX-8, y = event.layerY-8;
  let [[r, phi]] = func(...toRPhi((x-cx)/scale, -(y-cy)/scale));
  console.log(r, phi);
}
canvas.addEventListener("mousemove", look);
canvas.addEventListener("click", click);
</script>
</body>
</html>
